---
layout: project
title: 'Sample Leaflet Map in RStudio'
caption: Using Leaflet to make a nice map in RStudio.
description: >
  Using local nursing home data from Sonoma County to create a map of Covid-19 infections.
date: 27 Aug 2020
image: 
  path: assets/img/projects/hydejack-site.jpg
  srcset: 
    2560w: /assets/img/projects/sample_map_sonoma.PNG
    1280w: /assets/img/projects/sample_map_sonoma@0.50x.PNG
    640w: /assets/img/projects/sample_map_sonoma@0.25x.PNG

links: 
  - title: Repository on GitHub
    url: https://github.com/bill-herron/sonoma_county_snf.git

accent_color: '#4fb1ba'
accent_image:
  background: 'linear-gradient(to bottom, #0a7b81 0%, #01636e 25%, #02505b 50%, #073a4a 75%, #082e39 100%)'
  background: 'linear-gradient(to bottom, #7f7053 0%, #72654b 25%, #665a42 50%, #594e3a 75%, #4c4332 100% )'
  background: 'linear-gradient(to bottom, #665a42 0%, #594e3a 25%, #4c4332 50%, #40382a 75%, #332d21 100% )'
  
  overlay:    true
sitemap: false
---

Everybody has been impacted a little differently by the Covid-19 epidemic.  In Sonoma County (Northern California),
the hotspots are skilled nursing facilties (SNF's).  

I pieced together some data from the State of California, plus some data I took from the local newspaper.
It was surprising how "poor" the data was, a lot of cleanup was required, plus some manual entry and reformatting
of the spreadsheet.  The source of data for this example is the spreadsheet, which has been included
in the GitHub repository.

The difficult part was to figure out away for the markers to group together nearby locations
while still showing infection severity with the use of colors on the grouped icon.

The actual R code which generates the map is as follows:
```yml
leaflet(width = "100%") %>%
  addTiles() %>%
  addLegend("bottomleft", 
    colors =c("lightblue",  "orange", "red"),
    labels= c("low (0 - 2)", "moderate (3 - 11)","severe (> 11)"),  
    title= "Infection Severity",
    opacity = .75) %>%
    addControl(rr2, position = "topright") %>%
    addLogo("https://raw.githubusercontent.com/bill-herron/sonoma_county_snf/master/Zanden-Logo.PNG", width = 120,
      height = 120, alpha = .5, , url = "https://www.zanden.com/") %>% 
    addAwesomeMarkers(data=my_homes,
            group=~colorBuckets,
            icon = icons,
            popup = my_sites,
            label = my_homes$SHORTNAME,
         labelOptions = labelOptions(noHide = T, opacity = .65, textOnly = FALSE, textsize = "10px", direction = "right"), clusterOptions = markerClusterOptions(
            iconCreateFunction = JS(jsscript3))) %>% addMiniMap(
    toggleDisplay = TRUE, zoomAnimation = TRUE,
    tiles = providers$Stadia.OSMBright, height=100, width=150)
```

Feel free to [clone](https://github.com/bill-herron/sonoma_county_snf.git) the repository if you want to try this in RStudio.
{:.figcaption}

<iframe src="/assets/covid-19-sonoma-county.html" frameborder="1" style="overflow:hidden;width:100%" marginwidth="0" width = "100%" height = "800"></iframe>

Here is a live view of the html generated by the [knitr](https://www.r-project.org/nosvn/pandoc/knitr.html) function.
{:.figcaption}

